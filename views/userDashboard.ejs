<% layout('layouts/boilerplate') %>
<style>
  .container {
    margin: auto;
    padding-bottom: 20px;
  }
  .table {
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    width: 100%;
    background-color: #fff;
    border: none;
    font-size: 1rem;
    text-align: center;
    margin-bottom: 30px;
    
  }

  .table th, .table td {
    vertical-align: middle;

  }
  .card {
    display: flex;
    border-radius: 10px;
    height: 200px;
    text-align: center;
    font-size: medium;
    justify-content: center;
    align-items: center;
    border: 2px solid #ddd;
    transition: transform 0.3s ease;
    cursor: pointer;
    gap: 15px;
    h4, h2 {
      color: white;

    }
    
  }
  .card:hover {
    transform: translateY(-10px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.2);
  }
  .totalComplaints {
    background-image: linear-gradient(to top, #FEB47B , #FF7E5F80 );
  }
  .pendingComplaints {
    background-image: linear-gradient(to bottom, #66A6FF , #89F7FE );
    
  }
  .resolvedComplaints {
    background-image: linear-gradient(to top, #38EF7D , #11998E );
  }
  .btn {
    min-width: 200px;
  }
  .alert {
    border-radius: 10px;
  }
  .badge {
    font-size: 1rem;
  }
  @media (max-width: 768px) {
    .table, .card {
      width: 100%;
    }
  
  }


</style>
<div class="container mt-4">
  <!-- Flash Messages -->
  <% if (success && success.length > 0) { %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <%= success %>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  <% } %>

  <% if (error && error.length > 0) { %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <%= error %>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  <% } %>

  <!-- Welcome -->
  <h2 class="mb-3">Welcome, <%= user.name %> ðŸ‘‹</h2>

  <!-- Stats -->
  <div class="row text-center mb-4 g-4">
    <div class="col-md-4">
      <div class="card shadow-sm p-3 bg-light text-dark totalComplaints">
        <div class="card-img">
          <img src="complain.png" alt="total" height="70px" width="65px">
        </div>
        <div class="card-content">
          <h4>Total Complaints Registered</h4>
          <h2><%= totalComplaints %></h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm p-3 bg-warning text-dark pendingComplaints">
        <div class="card-img">
          <img src="pending-d.png" alt="pending" height="70px" width="65px">
        </div>
        <div class="card-content">
          <h4>Number of grievance pending</h4>
          <h2><%= pendingComplaints %></h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm p-3 bg-success text-white resolvedComplaints">
        <div class="card-img">
          <img src="close-d.png" alt="resolved" height="70px" width="65px">
        </div>
        <div class="card-content">
          <h4>Number of grievance resolved</h4>
          <h2><%= resolvedComplaints %></h2>
        </div>
      </div>
    </div>
  </div>
  <a href="/complaints/new" class="btn btn-primary mb-4">âž• Register New Complaint</a>
  <!-- Complaints Table -->
  <h4>Your Complaints</h4>
<div class="table-responsive">
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>Title</th>
        <th>Category</th>
        <th>Status</th>
        <th>Date</th>
        <th>View</th>
      </tr>
    </thead>
    <tbody>
      <% complaints.forEach(c => { %>
        <tr>
          <td><%= c.title %></td>
          <td><%= c.category %></td>
          <td>
            <% if (c.status === "Pending") { %>
              <span class="badge bg-warning">Pending</span>
            <% } else { %>
              <span class="badge bg-success">Resolved</span>
            <% } %>
          </td>
          <td><%= c.createdAt.toDateString() %></td>
          <td>
            <a href="/complaints/<%= c._id %>" class="btn btn-sm btn-primary">Details</a>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>