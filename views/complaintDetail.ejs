<% layout('layouts/boilerplate') %>

  <div class="container mt-4 mb-5">
    <h3>Complaint Details</h3>
    <hr>

    <!-- Title & Status -->
    <div class="d-flex justify-content-between align-items-center">
      <h4>
        <%= complaint.title %>
      </h4>
      <% if(complaint.status==="Pending" ) { %>
        <span class="badge bg-warning text-dark">Pending</span>
        <% } else { %>
          <span class="badge bg-success">Resolved</span>
          <% } %>
    </div>

    <!-- Complaint Info -->
    <p><strong>Category:</strong>
      <%= complaint.category %>
    </p>
    <p><strong>Description:</strong>
      <%= complaint.description %>
    </p>
    <p><strong>Submitted By:</strong>
      <%= complaint.user.name %>
    </p>
    <p><strong>Date:</strong>
      <%= complaint.createdAt.toDateString() %>
    </p>

    <!-- Uploaded Image -->
    <% if(complaint.image) { %>
      <div class="mt-3">
        <h5>Attached Photo:</h5>
        <img src="<%= complaint.image %>" alt="Complaint Image" class="img-fluid rounded shadow-sm"
          style="max-height:300px; object-fit: cover; width: 350px;">
      </div>
      <% } %>

        <!-- Map Preview with Leaflet -->
        <% if (complaint.latitude && complaint.longitude) { %>
          <div class="mt-4">
            <h5>Location:</h5>
            <div id="map" style="height:300px; border-radius:10px;"></div>
            <div class="mt-3">
      <p>
        <strong>Latitude:</strong> <%= complaint.latitude %> 
        <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('<%= complaint.latitude %>')">Copy</button>
        &nbsp;&nbsp;
        <strong>Longitude:</strong> <%= complaint.longitude %> 
        <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('<%= complaint.longitude %>')">Copy</button>
      </p>
    </div>
          </div>

          <% } %>

            <div class="mt-4">
              <a href="/dashboard" class="btn btn-secondary">â¬… Back to Dashboard</a>
            </div>
  </div>


  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
  <% if (complaint.latitude && complaint.longitude) { %>
    const map = L.map('map').setView([<%= complaint.latitude %>, <%= complaint.longitude %>], 15);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      L.marker([<%= complaint.latitude %>, <%= complaint.longitude %>]).addTo(map)
        .bindPopup("<b><%= complaint.title %></b>").openPopup();
  <% } %>
  // Copy function
  function copyToClipboard(value) {
    navigator.clipboard.writeText(value).then(() => {
      alert("Copied: " + value);
    }).catch(err => {
      console.error("Failed to copy: ", err);
    });
  }
  </script>